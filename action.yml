name: 'WordPress Theme Check Action'
description: 'Runs the Theme Check plugin against your theme'
author: 'The WordPress Contributors'
inputs:
  root-folder:
    description: 'The location of your theme'
    default: .
  accessible-ready:
    description: 'Whether to run the full accessibility tests'
    default: false
  ui-debug:
    description: 'More verbose logging; Creates a GIF'
    default: false
outputs:
  screenshots: 
    description: "Path to screenshots"
    value: ${{ steps.pre.outputs.location}}
branding:
  icon: 'clipboard'  
  color: 'blue'
runs:
  using: 'composite'
  steps:
    - name: Copy host folder
      run: |
        echo Copying theme folder ...
        rsync -av --exclude=.git* ${{ inputs.root-folder }}/* ${{ github.action_path }}/test-theme
      shell: bash

      ## Runs some configurations to be used but other actions.
    - name: Pre-Configure environment
      id: pre
      run:  |
        cd ${{ github.action_path }} && node set-configs.js
        cd ${{ github.action_path }} && node create-wp-env-override.js
      shell: bash

      ## Run unit tests to test that the correct files exist.
      ## If these files don't exist, the environment won't start up
    - name: Run Theme Structure Test
      run: cd ${{ github.action_path }} && npm run check:structure
      env:
        THEME_TYPE: ${{ steps.pre.outputs.theme-type }}
      shell: bash

      ## The following tests require an environment
      ## Start the environment
    - name: Install Environment
      run: cd ${{ github.action_path }} && npm run install:environment
      env:
        WP_ENV_PORT: 8888
        WP_ENV_TESTS_PORT: 8889
      shell: bash

      ## Run checks using theme-check plugin
    - name: Run Theme Check
      run: cd ${{ github.action_path }} && npm run check:theme-check
      env:
        CI: true
      shell: bash

      ## Run checks using e2e
    - name: Run Basic JS Checks
      run: cd ${{ github.action_path }} && npm run check:ui
      env:
        UI_DEBUG: ${{ inputs.ui-debug }}
        TEST_ACCESSIBILITY: ${{ inputs.accessible-ready }}
        THEME_TYPE: ${{ steps.pre.outputs.theme-type }}
        WP_ENV_TESTS_PORT: 8889
        CI: true
      shell: bash
    

    